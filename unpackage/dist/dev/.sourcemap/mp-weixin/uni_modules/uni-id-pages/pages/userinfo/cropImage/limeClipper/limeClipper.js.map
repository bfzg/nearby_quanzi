{"version":3,"sources":["webpack:///C:/Users/yuan/Desktop/xiaoshuo/uni_modules/uni-id-pages/pages/userinfo/cropImage/limeClipper/limeClipper.vue?e768","webpack:///C:/Users/yuan/Desktop/xiaoshuo/uni_modules/uni-id-pages/pages/userinfo/cropImage/limeClipper/limeClipper.vue?d63b","webpack:///C:/Users/yuan/Desktop/xiaoshuo/uni_modules/uni-id-pages/pages/userinfo/cropImage/limeClipper/limeClipper.vue?c25b","webpack:///C:/Users/yuan/Desktop/xiaoshuo/uni_modules/uni-id-pages/pages/userinfo/cropImage/limeClipper/limeClipper.vue?9188","uni-app:///uni_modules/uni-id-pages/pages/userinfo/cropImage/limeClipper/limeClipper.vue","webpack:///C:/Users/yuan/Desktop/xiaoshuo/uni_modules/uni-id-pages/pages/userinfo/cropImage/limeClipper/limeClipper.vue?ab2d","webpack:///C:/Users/yuan/Desktop/xiaoshuo/uni_modules/uni-id-pages/pages/userinfo/cropImage/limeClipper/limeClipper.vue?7477"],"names":["name","props","value","type","default","customStyle","canvasId","zIndex","imageUrl","fileType","quality","width","height","minWidth","maxWidth","minHeight","maxHeight","isLockWidth","isLockHeight","isLockRatio","scaleRatio","minRatio","maxRatio","isDisableScale","isDisableRotate","isLimitMove","isShowPhotoBtn","isShowRotateBtn","isShowConfirmBtn","isShowCancelBtn","rotateAngle","source","album","camera","message","data","canvasWidth","canvasHeight","clipX","clipY","clipWidth","clipHeight","animation","imageWidth","imageHeight","imageTop","imageLeft","scale","angle","image","sysinfo","throttleTimer","throttleFlag","timeClipCenter","flagClipTouch","flagEndTouch","clipStart","animationTimer","touchRelative","x","y","hypotenuseLength","ctx","computed","clipStyle","imageStyle","clipSize","clipPoint","watch","path","handler","heightVal","clearTimeout","mounted","methods","setDiffData","Object","getImageInfo","uni","title","mask","src","success","cache","fail","setClipInfo","setClipCenter","calcClipSize","cutDetectionPosition","cutDetectionPositionLeft","cutDetectionPositionTop","imgComputeSize","imgMarginDetectionScale","imgMarginDetectionPosition","currentScale","left","top","throttle","moveDuring","moveStop","clipTouchStart","icon","duration","corner","clipTouchMove","clipTouchEnd","imageTouchStart","imageTouchMove","hypotenuse","imageTouchEnd","uploadImage","b","count","sizeType","sourceType","wx","itemList","_uploadImage","imageReset","imageLoad","rotate","confirm","dpr","imageType","destWidth","destHeight","console","url","setTimeout","draw","cancel"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAoI;AACpI;AAC+D;AACL;AACqC;;;AAG/F;AAC0K;AAC1K,gBAAgB,mLAAU;AAC1B,EAAE,iFAAM;AACR,EAAE,kGAAM;AACR,EAAE,2GAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,sGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAA8nB,CAAgB,mpBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;ACiDlpB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;AAAA,gBACA;EACA;EACAA;EACAC;IACAC;MACAC;MACAC;IACA;IAEAD;MACAA;MACAC;IACA;IAEAC;MACAF;IACA;IACAG;MACAH;MACAC;IACA;IACAG;MACAJ;MACAC;IACA;IACAI;MACAL;IACA;IACAM;MACAN;MACAC;IACA;IACAM;MACAP;MACAC;IACA;IACAO;MACAR;MACAC;IACA;IACAQ;MACAT;MACAC;IACA;IACAS;MACAV;MACAC;IACA;IACAU;MACAX;MACAC;IACA;IACAW;MACAZ;MACAC;IACA;IACAY;MACAb;MACAC;IACA;IACAa;MACAd;MACAC;IACA;IACAc;MACAf;MACAC;IACA;IACAe;MACAhB;MACAC;IACA;IACAgB;MACAjB;MACAC;IACA;IACAiB;MACAlB;MACAC;IACA;IACAkB;MACAnB;MACAC;IACA;IACAmB;MACApB;MACAC;IACA;IACAoB;MACArB;MACAC;IACA;IACAqB;MACAtB;MACAC;IACA;IACAsB;MACAvB;MACAC;IACA;IACAuB;MACAxB;MACAC;IACA;IACAwB;MACAzB;MACAC;IACA;IACAyB;MACA1B;MACAC;IACA;IACA0B;MACA3B;MACAC;IACA;IACA2B;MACA5B;MACAC;QAAA;UACA4B;UACAC;UAEAC;QAEA;MAAA;IACA;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QAAAC;QAAAC;MAAA;MACAC;MACAC;IACA;EACA;EACAC;IACAC;MACA;QAAAvB;QAAAF;QAAAD;QAAAI;MACA,gCACAF,wCACAC,uDACAC,yDACAJ,kCACAC;IAEA;IACA0B;MACA;QAAArB;QAAAE;QAAAD;QAAAH;QAAAK;QAAAC;MACA,kCACAL,uEACAC,wFACAE,gLACAJ;IAEA;IACAwB;MACA;QAAAzB;MACA;QAAAD;QAAAC;MAAA;IACA;IACA0B;MACA;QAAA7B;MACA;QAAAC;QAAAD;MAAA;IACA;EACA;EACA8B;IACAlE;MACA;QACA;QACA;MACA;QACA;UACA;YAAAyC;YAAAC;YAAAE;YAAAD;YAAAE;YAAAT;YAAAC;YAAAC;YAAAC;YAAA4B;UACA;YACA;UACA;YACA;cAAA1B;cAAAC;cAAAE;cAAAD;cAAAE;cAAAT;cAAAC;cAAAC;cAAAC;YAAA;UACA;QAEA;MAEA;IACA;IACAjC;MACA;IACA;IACAyC;MACAqB;QAAA;UAAA;YAAA;cAAA;gBAAA;kBACA;gBAAA;gBAAA;kBAAA;cAAA;YAAA;UAAA;QAAA,CACA;QAAA;UAAA;QAAA;QAAA;MAAA;MACA;IACA;IACAJ;MAAA;QAAAK;MACA;QAAAxD;MACAF;MACAE;MACA;QACA;UAAAyB;QAAA;MACA;MACA;QACA;UAAAC;QAAA;MACA;MACA;IACA;IACAO;MACA;MACA;MACA;MACA;QACA;UACAA;QACA;MACA;MACA;IACA;IACAN;MAAA;MACA8B;MACA;QACA;UACA;YACA9B;UACA;QACA;QACA;UAAAe;QAAA;QACA;MACA;IACA;IACAhC;MACA;QACA;UACA;YACAuB;UACA;QACA;QACA;MACA;IACA;IACAmB;MACA;IACA;IACAxD;MACA;QACA;UACA6B;QACA;MACA;IACA;IACA5B;MACA;QACA;UACA6B;QACA;MACA;IACA;EACA;EACAgC;IACA;IACA;IACA;IACA;MACA;IACA;IACA;IACA;IACA;EACA;EACAC;IACAC;MAAA;MACAC;QACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACA;QACAC;UACAC;UACAC;QACA;MACA;MACAF;QACAG;QACAC;UACA;UACA;UACA;YACA;YACA;UACA;UACA;YAAAtC;YAAAE;YAAAD;YAAAE;YAAAT;YAAAC;YAAAC;YAAAC;UACA0C;YAAAxC;YAAAC;YAAAE;YAAAD;YAAAE;YAAAT;YAAAC;YAAAC;YAAAC;UAAA;QACA;QACA2C;UACA;UACA;YACA;UACA;QACA;MACA;IAEA;IACAC;MACA;QAAAzE;QAAAsC;QAAA5C;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAgF;MACA;QAAA7C;QAAAD;QAAAK;QAAAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAyC;MACA;QAAA/C;QAAAU;QAAAZ;QAAAC;MACA;QACA;UACAC;QACA;MACA;QACA;UACAF;QACA;MACA;MACA;QACA;UACAG;QACA;MACA;QACA;QACA;UACAF;QACA;MACA;IACA;IACAiD;MAAA;MACA;QAAAjD;QAAAW;QAAAT;QAAAD;MACA;UACA;YACA;cAAAD;YAAA;UACA;UACA;YACA;cAAAA;YAAA;UACA;QACA;QACAkD;UACA;YACA;cAAAnD;YAAA;UACA;UACA;YACA;cAAAA;YAAA;UACA;QACA;MACA;QACA;QACA;QACA;UACAA;UACAC;QACA;MACA;QACAmD;QACAD;MACA;QACAC;QACA;UACApD;QACA;MACA;QACAmD;QACA;UACAlD;QACA;MACA;IACA;IACAoD;MACA;QAAAhD;QAAAC;MACA;MACA;IACA;IACAgD;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;QAAAC;QAAAC;QAAAC;MACA;QACAlD;QACAD;QACAE;MACA;IACA;IACAkD;MACA;QACA7C;MACA;IACA;IACA8C;MACA1B;IACA;IACA2B;MAAA;MACA3B;MACA;QACA;UACA;YAAA9B;UAAA;QACA;QACA;MACA;MACA;QAAAW;MAAA;IACA;IACA+C;MAIA;QACAtB;UACAC;UACAsB;UACAC;QACA;QACA;MACA;MACA;MACA;MACA;QAAA/D;QAAAC;QAAAC;MACA;MACA;MACA;QAAA;MAAA;MACA;QACA9B;QACAC;QACA+C;QACAC;QACArB;QACAD;QACAiE;MACA;MACA;MACA;IACA;IACAC;MAKA;QACA1B;UACAC;UACAsB;UACAC;QACA;QACA;MACA;MACA;MACA;QACA;MAEA;MACA;QAAAlD;MACA;QACA;UAAAlC;UAAAD;QACA;QACA;UACAmC;QACA;QACA;QACA;QACA;UACA;YAAAxC;YAAA0B;YAAAC;UACA;YACA;cACAC;cACAC;cACAH;cACAC;YACA;UACA;YACA;cACAC;cACAF;YACA;UACA;YACA;cACAG;cACAF;YACA;UACA;UACA;QACA;MAEA;IACA;IACAkE;MACA;MACA;IACA;IACAC;MAIA;MACA;QAAA7D;MACA;MACA;MAEA;MACA;QACAa;UACAC;UACAC;QACA;QACA;MACA;QACA;QACA;QACA;QACA;QACA;QAEAF,iBACA;UACAC;UACAC;QACA,GACA;UACAD;UACAC;QACA,EACA;QACA;QACA;MACA;IACA;IACA+C;MAIA;QAAAvD;MACA;MACA;MACA;MACA;QAAAA;MAAA;MACA;MACA;MACA;QACA;UAAAN;UAAAD;QACA;UACAC;UACAD;QACA;QACA;MACA;QACA;QACA;QACA;UACAjC;UACAgG;UACA7D;QACA;UAEAA;QACA;UACAA;UACAA;UACA;YACApC;YACAC;UACA;QACA;QAEA;QACA;QACA;MACA;IACA;IACAiG;MACA;QACAtD;MACA;MACA;IACA;IACAuD;MAAA;MACA;MACA;MACA;QAAA;UAAAC;QACA;MACA;MACA;QACA;UACAjC;YACAkC;YACAC;YACAC;YACAhC;UACA;QACA;QAEA;UACAiC;YACAH;YACA7G;YACA+E;UACA;QACA;MAEA;MACA;QACAJ;UACAsC;YAAA;UAAA;UACAlC;YAAA;YACAmC;UACA;QACA;MACA;QACAA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACAzC;MACA;IACA;IACA0C;MACA;MACA;QACA1C;UACAC;UACAsB;UACAC;QACA;QACA;MACA;MACA;MACA;MACA;MACA;QACA;MACA;QACA;MACA;MACA;IACA;IACAmB;MAAA;MACA;QACA3C;UACAC;UACAsB;UACAC;QACA;QACA;MACA;MACAxB;QACAC;MACA;MACA;QAAA3C;QAAAK;QAAAD;QAAAsB;QAAAf;QAAAD;QAAAD;QAAAP;QAAAC;QAAAS;QAAA0E;QAAAzE;QAAAvC;QAAAD;QAAAkH;QAAArH;MACA;QACA;QACA;QACA;QACA;QACAwD;QACAA;QACAA;QACAA;UACA;UACA;UACA;YACAH;YACAC;YACAjD;YACAC;YACAgH;YACAC;YACAvH;YACAG;YACAC;YACAwE;cACA/C;cACA2C;cACA;cACA;YACA;YACAM;cACA0C;cACA;cACA;YACA;UACA;UAEA;YACAC;YACApH;YACAC;UACA;UACAkE;QACA;MACA;MAEA;QACA;QACA;QACAhB;QACA;UACAkE;YACAC;UACA;QACA;MACA;QACAA;MACA;IACA;IACAC;MACA;MACA;IACA;EACA;AACA;AAAA,4B;;;;;;;;;;;;;AC9yBA;AAAA;AAAA;AAAA;AAAk7B,CAAgB,46BAAG,EAAC,C;;;;;;;;;;;ACAt8B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"uni_modules/uni-id-pages/pages/userinfo/cropImage/limeClipper/limeClipper.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./limeClipper.vue?vue&type=template&id=d7d092c6&scoped=true&\"\nvar renderjs\nimport script from \"./limeClipper.vue?vue&type=script&lang=js&\"\nexport * from \"./limeClipper.vue?vue&type=script&lang=js&\"\nimport style0 from \"./limeClipper.vue?vue&type=style&index=0&id=d7d092c6&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"d7d092c6\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"uni_modules/uni-id-pages/pages/userinfo/cropImage/limeClipper/limeClipper.vue\"\nexport default component.exports","export * from \"-!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./limeClipper.vue?vue&type=template&id=d7d092c6&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./limeClipper.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./limeClipper.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"l-clipper\" :class=\"{open: value}\" disable-scroll :style=\"'z-index: ' + zIndex + ';' + customStyle\">\r\n\t\t<view class=\"l-clipper-mask\" @touchstart.stop.prevent=\"clipTouchStart\" @touchmove.stop.prevent=\"clipTouchMove\" @touchend.stop.prevent=\"clipTouchEnd\">\r\n\t\t\t<view class=\"l-clipper__content\" :style=\"clipStyle\"><view class=\"l-clipper__edge\" v-for=\"(item, index) in [0, 0, 0, 0]\" :key=\"index\"></view></view>\r\n\t\t</view>\r\n\t\t<image\r\n\t\t\tclass=\"l-clipper-image\"\r\n\t\t\t@error=\"imageLoad\"\r\n\t\t\t@load=\"imageLoad\"\r\n\t\t\t@touchstart.stop.prevent=\"imageTouchStart\"\r\n\t\t\t@touchmove.stop.prevent=\"imageTouchMove\"\r\n\t\t\t@touchend.stop.prevent=\"imageTouchEnd\"\r\n\t\t\t:src=\"image\"\r\n\t\t\t:mode=\"imageWidth == 'auto' ? 'widthFix' : ''\"\r\n\t\t\tv-if=\"image\"\r\n\t\t\t:style=\"imageStyle\"\r\n\t\t/>\r\n\t\t<canvas\r\n\t\t\t:canvas-id=\"canvasId\"\r\n\t\t\tid=\"l-clipper\"\r\n\t\t\tdisable-scroll\r\n\t\t\t:style=\"'width: ' + canvasWidth * scaleRatio + 'px; height:' + canvasHeight * scaleRatio + 'px;'\"\r\n\t\t\tclass=\"l-clipper-canvas\"\r\n\t\t></canvas>\r\n\t\t<view class=\"l-clipper-tools\">\r\n\t\t\t<view class=\"l-clipper-tools__btns\">\r\n\t\t\t\t<view v-if=\"isShowCancelBtn\" @tap=\"cancel\">\r\n\t\t\t\t\t<slot name=\"cancel\" v-if=\"$slots.cancel\" />\r\n\t\t\t\t\t<view v-else class=\"cancel\">取消</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view v-if=\"isShowPhotoBtn\" @tap=\"uploadImage\">\r\n\t\t\t\t\t<slot name=\"photo\" v-if=\"$slots.photo\" />\r\n\t\t\t\t\t<image v-else src=\"./images/photo.svg\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<view v-if=\"isShowRotateBtn\" @tap=\"rotate\">\r\n\t\t\t\t\t<slot name=\"rotate\" v-if=\"$slots.rotate\" />\r\n\t\t\t\t\t<image v-else src=\"./images/rotate.svg\" data-type=\"inverse\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<view v-if=\"isShowConfirmBtn\" @tap=\"confirm\">\r\n\t\t\t\t\t<slot name=\"confirm\" v-if=\"$slots.confirm\" />\r\n\t\t\t\t\t<view v-else class=\"confirm\">确定</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<slot></slot>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { determineDirection, calcImageOffset, calcImageScale, calcImageSize, calcPythagoreanTheorem, clipTouchMoveOfCalculate, imageTouchMoveOfCalcOffset } from './utils';\r\nconst cache = {}\r\nexport default {\r\n\t// version: '0.6.3',\r\n\tname: 'l-clipper',\r\n\tprops: {\r\n\t\tvalue: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\t\t// #ifdef MP-WEIXIN\r\n\t\ttype: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: '2d'\r\n\t\t},\r\n\t\t// #endif\r\n\t\tcustomStyle: {\r\n\t\t\ttype: String,\r\n\t\t},\r\n\t\tcanvasId: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 'l-clipper'\r\n\t\t},\r\n\t\tzIndex: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 99\r\n\t\t},\r\n\t\timageUrl: {\r\n\t\t\ttype: String\r\n\t\t},\r\n\t\tfileType: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 'png'\r\n\t\t},\r\n\t\tquality: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 1\r\n\t\t},\r\n\t\twidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 400\r\n\t\t},\r\n\t\theight: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 400\r\n\t\t},\r\n\t\tminWidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 200\r\n\t\t},\r\n\t\tmaxWidth: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 600\r\n\t\t},\r\n\t\tminHeight: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 200\r\n\t\t},\r\n\t\tmaxHeight: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 600\r\n\t\t},\r\n\t\tisLockWidth: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tisLockHeight: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tisLockRatio: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\t\tscaleRatio: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 1\r\n\t\t},\r\n\t\tminRatio: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0.5\r\n\t\t},\r\n\t\tmaxRatio: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 2\r\n\t\t},\r\n\t\tisDisableScale: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tisDisableRotate: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tisLimitMove: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tisShowPhotoBtn: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\t\tisShowRotateBtn: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\t\tisShowConfirmBtn: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\t\tisShowCancelBtn: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\t\trotateAngle: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 90\r\n\t\t},\r\n\t\tsource: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => ({\r\n\t\t\t\t\talbum: '从相册中选择',\r\n\t\t\t\t\tcamera: '拍照',\r\n\t\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\t\tmessage: '从微信中选择'\r\n\t\t\t\t\t// #endif\r\n\t\t\t\t})\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tcanvasWidth: 0,\r\n\t\t\tcanvasHeight: 0,\r\n\t\t\tclipX: 0,\r\n\t\t\tclipY: 0,\r\n\t\t\tclipWidth: 0,\r\n\t\t\tclipHeight: 0,\r\n\t\t\tanimation: false,\r\n\t\t\timageWidth: 0,\r\n\t\t\timageHeight: 0,\r\n\t\t\timageTop: 0,\r\n\t\t\timageLeft: 0,\r\n\t\t\tscale: 1,\r\n\t\t\tangle: 0,\r\n\t\t\timage: this.imageUrl,\r\n\t\t\tsysinfo: {},\r\n\t\t\tthrottleTimer: null,\r\n\t\t\tthrottleFlag: true,\r\n\t\t\ttimeClipCenter: null,\r\n\t\t\tflagClipTouch: false,\r\n\t\t\tflagEndTouch: false,\r\n\t\t\tclipStart: {},\r\n\t\t\tanimationTimer: null,\r\n\t\t\ttouchRelative: [{x: 0,y: 0}],\r\n\t\t\thypotenuseLength: 0,\r\n\t\t\tctx: null\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tclipStyle() {\r\n\t\t\tconst {clipWidth, clipHeight, clipY, clipX, animation} = this\r\n\t\t\treturn  `\r\n\t\t\twidth: ${clipWidth}px;\r\n\t\t\theight:${clipHeight}px;\r\n\t\t\ttransition-property: ${animation ? '' : 'background'};\r\n\t\t\tleft: ${clipX}px;\r\n\t\t\ttop: ${clipY}px\r\n\t\t\t`\r\n\t\t},\r\n\t\timageStyle() {\r\n\t\t\tconst {imageWidth, imageHeight, imageLeft, imageTop, animation, scale, angle} = this\r\n\t\t\treturn `\r\n\t\t\t\twidth: ${imageWidth ? imageWidth + 'px' : 'auto'};\r\n\t\t\t\theight: ${imageHeight ? imageHeight + 'px' : 'auto'};\r\n\t\t\t\ttransform: translate3d(${imageLeft - imageWidth / 2}px, ${imageTop - imageHeight / 2}px, 0) scale(${scale}) rotate(${angle}deg);\r\n\t\t\t\ttransition-duration: ${animation ? 0.35 : 0}s\r\n\t\t\t`\r\n\t\t},\r\n\t\tclipSize() {\r\n\t\t\tconst { clipWidth, clipHeight } = this;\r\n\t\t\treturn { clipWidth, clipHeight };\r\n\t\t},\r\n\t\tclipPoint() {\r\n\t\t\tconst { clipY, clipX } = this;\r\n\t\t\treturn { clipY, clipX };\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tvalue(val) {\r\n\t\t\tif(!val) {\r\n\t\t\t\tthis.animation = 0\r\n\t\t\t\tthis.angle = 0\r\n\t\t\t} else {\r\n\t\t\t\tif(this.imageUrl) {\r\n\t\t\t\t\tconst {imageWidth, imageHeight, imageLeft, imageTop, scale, clipX, clipY, clipWidth, clipHeight, path} = cache?.[this.imageUrl] || {}\r\n\t\t\t\t\tif(path != this.image) {\r\n\t\t\t\t\t\tthis.image = this.imageUrl;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.setDiffData({imageWidth, imageHeight, imageLeft, imageTop, scale, clipX, clipY, clipWidth, clipHeight})\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\timageUrl(url) {\r\n\t\t\tthis.image = url\r\n\t\t},\r\n\t\timage:{\r\n\t\t\thandler: async function(url) {\r\n\t\t\t\tthis.getImageInfo(url)\r\n\t\t\t},\r\n\t\t\t// immediate: true,\r\n\t\t},\r\n\t\tclipSize({ widthVal, heightVal }) {\r\n\t\t\tlet { minWidth, minHeight } = this;\r\n\t\t\tminWidth = minWidth / 2;\r\n\t\t\tminHeight = minHeight / 2;\r\n\t\t\tif (widthVal < minWidth) {\r\n\t\t\t\tthis.setDiffData({clipWidth: minWidth})\r\n\t\t\t}\r\n\t\t\tif (heightVal < minHeight) {\r\n\t\t\t\tthis.setDiffData({clipHeight: minHeight})\r\n\t\t\t}\r\n\t\t\tthis.calcClipSize();\r\n\t\t},\r\n\t\tangle(val) {\r\n\t\t\tthis.animation = true;\r\n\t\t\tthis.moveStop();\r\n\t\t\tconst { isLimitMove } = this;\r\n\t\t\tif (isLimitMove && val % 90) {\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tangle: Math.round(val / 90) * 90\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tthis.imgMarginDetectionScale();\r\n\t\t},\r\n\t\tanimation(val) {\r\n\t\t\tclearTimeout(this.animationTimer);\r\n\t\t\tif (val) {\r\n\t\t\t\tlet animationTimer = setTimeout(() => {\r\n\t\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\t\tanimation: false\r\n\t\t\t\t\t})\r\n\t\t\t\t}, 260);\r\n\t\t\t\tthis.setDiffData({animationTimer})\r\n\t\t\t\tthis.animationTimer = animationTimer;\r\n\t\t\t}\r\n\t\t},\r\n\t\tisLimitMove(val) {\r\n\t\t\tif (val) {\r\n\t\t\t\tif (this.angle % 90) {\r\n\t\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\t\tangle : Math.round(this.angle / 90) * 90\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tthis.imgMarginDetectionScale();\r\n\t\t\t}\r\n\t\t},\r\n\t\tclipPoint() {\r\n\t\t\tthis.cutDetectionPosition();\r\n\t\t},\r\n\t\twidth(width, oWidth) {\r\n\t\t\tif (width !== oWidth) {\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tclipWidth:  width / 2\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\theight(height, oHeight) {\r\n\t\t\tif (height !== oHeight) {\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tclipHeight:  height / 2\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tconst sysinfo = uni.getSystemInfoSync();\r\n\t\tthis.sysinfo = sysinfo;\r\n\t\tthis.setClipInfo();\r\n\t\tif(this.image) {\r\n\t\t\tthis.getImageInfo(this.image)\r\n\t\t}\r\n\t\tthis.setClipCenter();\r\n\t\tthis.calcClipSize();\r\n\t\tthis.cutDetectionPosition();\r\n\t},\r\n\tmethods: {\r\n\t\tsetDiffData(data) {\r\n\t\t\tObject.keys(data).forEach(key => {\r\n\t\t\t  if (this[key] !== data[key]) {\r\n\t\t\t\tthis[key] = data[key];\r\n\t\t\t  }\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetImageInfo(url) {\r\n\t\t\tif (!url) return;\r\n\t\t\tif(this.value) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '请稍候...',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tuni.getImageInfo({\r\n\t\t\t\tsrc: url,\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tthis.imgComputeSize(res.width, res.height);\r\n\t\t\t\t\tthis.image = res.path;\r\n\t\t\t\t\tif (this.isLimitMove) {\r\n\t\t\t\t\t\tthis.imgMarginDetectionScale();\r\n\t\t\t\t\t\tthis.$emit('ready', res);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst {imageWidth, imageHeight, imageLeft, imageTop, scale, clipX, clipY, clipWidth, clipHeight} = this\r\n\t\t\t\t\tcache[url] = Object.assign(res, {imageWidth, imageHeight, imageLeft, imageTop, scale, clipX, clipY, clipWidth, clipHeight});\r\n\t\t\t\t},\r\n\t\t\t\tfail: (err) => {\r\n\t\t\t\t\tthis.imgComputeSize();\r\n\t\t\t\t\tif (this.isLimitMove) {\r\n\t\t\t\t\t\tthis.imgMarginDetectionScale();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t\tsetClipInfo() {\r\n\t\t\tconst { width, height, sysinfo, canvasId } = this;\r\n\t\t\tconst clipWidth = width / 2;\r\n\t\t\tconst clipHeight = height / 2;\r\n\t\t\tconst clipY = (sysinfo.windowHeight - clipHeight) / 2;\r\n\t\t\tconst clipX = (sysinfo.windowWidth - clipWidth) / 2;\r\n\t\t\tconst imageLeft = sysinfo.windowWidth / 2;\r\n\t\t\tconst imageTop = sysinfo.windowHeight / 2;\r\n\t\t\tthis.ctx = uni.createCanvasContext(canvasId, this);\r\n\t\t\tthis.clipWidth = clipWidth;\r\n\t\t\tthis.clipHeight = clipHeight;\r\n\t\t\tthis.clipX = clipX;\r\n\t\t\tthis.clipY = clipY;\r\n\t\t\tthis.canvasHeight = clipHeight;\r\n\t\t\tthis.canvasWidth = clipWidth;\r\n\t\t\tthis.imageLeft = imageLeft;\r\n\t\t\tthis.imageTop = imageTop;\r\n\t\t},\r\n\t\tsetClipCenter() {\r\n\t\t\tconst { sysInfo, clipHeight, clipWidth, imageTop, imageLeft } = this;\r\n\t\t\tlet sys = sysInfo || uni.getSystemInfoSync();\r\n\t\t\tlet clipY = (sys.windowHeight - clipHeight) * 0.5;\r\n\t\t\tlet clipX = (sys.windowWidth - clipWidth) * 0.5;\r\n\t\t\tthis.imageTop = imageTop - this.clipY + clipY;\r\n\t\t\tthis.imageLeft = imageLeft - this.clipX + clipX;\r\n\t\t\tthis.clipY = clipY;\r\n\t\t\tthis.clipX = clipX;\r\n\t\t},\r\n\t\tcalcClipSize() {\r\n\t\t\tconst { clipHeight, clipWidth, sysinfo, clipX, clipY } = this;\r\n\t\t\tif (clipWidth > sysinfo.windowWidth) {\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tclipWidth:  sysinfo.windowWidth\r\n\t\t\t\t})\r\n\t\t\t} else if (clipWidth + clipX > sysinfo.windowWidth) {\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tclipX: sysinfo.windowWidth - clipX\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tif (clipHeight > sysinfo.windowHeight) {\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tclipHeight: sysinfo.windowHeight\r\n\t\t\t\t})\r\n\t\t\t} else if (clipHeight + clipY > sysinfo.windowHeight) {\r\n\t\t\t\tthis.clipY = sysinfo.windowHeight - clipY;\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tclipY: sysinfo.windowHeight - clipY\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tcutDetectionPosition() {\r\n\t\t\tconst { clipX, clipY, sysinfo, clipHeight, clipWidth } = this;\r\n\t\t\tlet cutDetectionPositionTop = () => {\r\n\t\t\t\t\tif (clipY < 0) {\r\n\t\t\t\t\t\tthis.setDiffData({clipY: 0})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (clipY > sysinfo.windowHeight - clipHeight) {\r\n\t\t\t\t\t\tthis.setDiffData({clipY: sysinfo.windowHeight - clipHeight})\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcutDetectionPositionLeft = () => {\r\n\t\t\t\t\tif (clipX < 0) {\r\n\t\t\t\t\t\tthis.setDiffData({clipX: 0})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (clipX > sysinfo.windowWidth - clipWidth) {\r\n\t\t\t\t\t\tthis.setDiffData({clipX: sysinfo.windowWidth - clipWidth})\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\tif (clipY === null && clipX === null) {\r\n\t\t\t\tlet newClipY = (sysinfo.windowHeight - clipHeight) * 0.5;\r\n\t\t\t\tlet newClipX = (sysinfo.windowWidth - clipWidth) * 0.5;\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tclipX: newClipX,\r\n\t\t\t\t\tclipY: newClipY\r\n\t\t\t\t})\r\n\t\t\t} else if (clipY !== null && clipX !== null) {\r\n\t\t\t\tcutDetectionPositionTop();\r\n\t\t\t\tcutDetectionPositionLeft();\r\n\t\t\t} else if (clipY !== null && clipX === null) {\r\n\t\t\t\tcutDetectionPositionTop();\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tclipX: (sysinfo.windowWidth - clipWidth) / 2\r\n\t\t\t\t})\r\n\t\t\t} else if (clipY === null && clipX !== null) {\r\n\t\t\t\tcutDetectionPositionLeft();\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tclipY: (sysinfo.windowHeight - clipHeight) / 2\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\timgComputeSize(width, height) {\r\n\t\t\tconst { imageWidth, imageHeight } = calcImageSize(width, height, this);\r\n\t\t\tthis.imageWidth = imageWidth;\r\n\t\t\tthis.imageHeight = imageHeight;\r\n\t\t},\r\n\t\timgMarginDetectionScale(scale) {\r\n\t\t\tif (!this.isLimitMove) return;\r\n\t\t\tconst currentScale = calcImageScale(this, scale);\r\n\t\t\tthis.imgMarginDetectionPosition(currentScale);\r\n\t\t},\r\n\t\timgMarginDetectionPosition(scale) {\r\n\t\t\tif (!this.isLimitMove) return;\r\n\t\t\tconst { scale: currentScale, left, top } = calcImageOffset(this, scale);\r\n\t\t\tthis.setDiffData({\r\n\t\t\t\timageLeft: left,\r\n\t\t\t\timageTop: top,\r\n\t\t\t\tscale: currentScale\r\n\t\t\t})\r\n\t\t},\r\n\t\tthrottle() {\r\n\t\t\tthis.setDiffData({\r\n\t\t\t\tthrottleFlag: true\r\n\t\t\t})\r\n\t\t},\r\n\t\tmoveDuring() {\r\n\t\t\tclearTimeout(this.timeClipCenter);\r\n\t\t},\r\n\t\tmoveStop() {\r\n\t\t\tclearTimeout(this.timeClipCenter);\r\n\t\t\tconst timeClipCenter = setTimeout(() => {\r\n\t\t\t\tif (!this.animation) {\r\n\t\t\t\t\tthis.setDiffData({animation: true})\r\n\t\t\t\t}\r\n\t\t\t\tthis.setClipCenter();\r\n\t\t\t}, 800);\r\n\t\t\tthis.setDiffData({timeClipCenter})\r\n\t\t},\r\n\t\tclipTouchStart(event) {\r\n\t\t\t// #ifdef H5\r\n\t\t\tevent.preventDefault()\r\n\t\t\t// #endif\r\n\t\t\tif (!this.image) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请选择图片',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 3000\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst currentX = event.touches[0].clientX;\r\n\t\t\tconst currentY = event.touches[0].clientY;\r\n\t\t\tconst { clipX, clipY, clipWidth, clipHeight } = this;\r\n\t\t\tconst corner = determineDirection(clipX, clipY, clipWidth, clipHeight, currentX, currentY);\r\n\t\t\tthis.moveDuring();\r\n\t\t\tif(!corner) {return}\r\n\t\t\tthis.clipStart = {\r\n\t\t\t\twidth: clipWidth,\r\n\t\t\t\theight: clipHeight,\r\n\t\t\t\tx: currentX,\r\n\t\t\t\ty: currentY,\r\n\t\t\t\tclipY,\r\n\t\t\t\tclipX,\r\n\t\t\t\tcorner\r\n\t\t\t};\r\n\t\t\tthis.flagClipTouch = true;\r\n\t\t\tthis.flagEndTouch = true;\r\n\t\t},\r\n\t\tclipTouchMove(event) {\r\n\t\t\t// #ifdef H5\r\n\t\t\tevent.stopPropagation()\r\n\t\t\tevent.preventDefault()\r\n\t\t\t// #endif\r\n\t\t\tif (!this.image) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请选择图片',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 3000\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// 只针对单指点击做处理\r\n\t\t\tif (event.touches.length !== 1) {\r\n\t\t\t\treturn;\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\tconst { flagClipTouch, throttleFlag } = this;\r\n\t\t\tif (flagClipTouch && throttleFlag) {\r\n\t\t\t\tconst { isLockRatio, isLockHeight, isLockWidth } = this;\r\n\t\t\t\tif (isLockRatio && (isLockWidth || isLockHeight)) return;\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\tthrottleFlag: false\r\n\t\t\t\t})\r\n\t\t\t\tthis.throttle();\r\n\t\t\t\tconst clipData = clipTouchMoveOfCalculate(this, event);\r\n\t\t\t\tif(clipData) {\r\n\t\t\t\t\tconst { width, height, clipX, clipY } = clipData;\r\n\t\t\t\t\tif (!isLockWidth && !isLockHeight) {\r\n\t\t\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\t\t\tclipWidth: width,\r\n\t\t\t\t\t\t\tclipHeight: height,\r\n\t\t\t\t\t\t\tclipX,\r\n\t\t\t\t\t\t\tclipY\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else if (!isLockWidth) {\r\n\t\t\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\t\t\tclipWidth: width,\r\n\t\t\t\t\t\t\tclipX\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else if (!isLockHeight) {\r\n\t\t\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\t\t\tclipHeight: height,\r\n\t\t\t\t\t\t\tclipY\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.imgMarginDetectionScale();\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\tclipTouchEnd() {\r\n\t\t\tthis.moveStop();\r\n\t\t\tthis.flagClipTouch = false;\r\n\t\t},\r\n\t\timageTouchStart(e) {\r\n\t\t\t// #ifdef H5\r\n\t\t\tevent.preventDefault()\r\n\t\t\t// #endif\r\n\t\t\tthis.flagEndTouch = false;\r\n\t\t\tconst { imageLeft, imageTop } = this;\r\n\t\t\tconst clientXForLeft = e.touches[0].clientX;\r\n\t\t\tconst clientYForLeft = e.touches[0].clientY;\r\n\r\n\t\t\tlet touchRelative = [];\r\n\t\t\tif (e.touches.length === 1) {\r\n\t\t\t\ttouchRelative[0] = {\r\n\t\t\t\t\tx: clientXForLeft - imageLeft,\r\n\t\t\t\t\ty: clientYForLeft - imageTop\r\n\t\t\t\t};\r\n\t\t\t\tthis.touchRelative = touchRelative;\r\n\t\t\t} else {\r\n\t\t\t\tconst clientXForRight = e.touches[1].clientX;\r\n\t\t\t\tconst clientYForRight = e.touches[1].clientY;\r\n\t\t\t\tlet width = Math.abs(clientXForLeft - clientXForRight);\r\n\t\t\t\tlet height = Math.abs(clientYForLeft - clientYForRight);\r\n\t\t\t\tconst hypotenuseLength = calcPythagoreanTheorem(width, height);\r\n\r\n\t\t\t\ttouchRelative = [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tx: clientXForLeft - imageLeft,\r\n\t\t\t\t\t\ty: clientYForLeft - imageTop\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tx: clientXForRight - imageLeft,\r\n\t\t\t\t\t\ty: clientYForRight - imageTop\r\n\t\t\t\t\t}\r\n\t\t\t\t];\r\n\t\t\t\tthis.touchRelative = touchRelative;\r\n\t\t\t\tthis.hypotenuseLength = hypotenuseLength;\r\n\t\t\t}\r\n\t\t},\r\n\t\timageTouchMove(e) {\r\n\t\t\t// #ifdef H5\r\n\t\t\tevent.preventDefault()\r\n\t\t\t// #endif\r\n\t\t\tconst { flagEndTouch, throttleFlag } = this;\r\n\t\t\tif (flagEndTouch || !throttleFlag) return;\r\n\t\t\tconst clientXForLeft = e.touches[0].clientX;\r\n\t\t\tconst clientYForLeft = e.touches[0].clientY;\r\n\t\t\tthis.setDiffData({throttleFlag: false})\r\n\t\t\tthis.throttle();\r\n\t\t\tthis.moveDuring();\r\n\t\t\tif (e.touches.length === 1) {\r\n\t\t\t\tconst { left: imageLeft, top:  imageTop} = imageTouchMoveOfCalcOffset(this, clientXForLeft, clientYForLeft);\r\n\t\t\t\tthis.setDiffData({\r\n\t\t\t\t\timageLeft,\r\n\t\t\t\t\timageTop\r\n\t\t\t\t})\r\n\t\t\t\tthis.imgMarginDetectionPosition();\r\n\t\t\t} else {\r\n\t\t\t\tconst clientXForRight = e.touches[1].clientX;\r\n\t\t\t\tconst clientYForRight = e.touches[1].clientY;\r\n\t\t\t\tlet width = Math.abs(clientXForLeft - clientXForRight),\r\n\t\t\t\t\theight = Math.abs(clientYForLeft - clientYForRight),\r\n\t\t\t\t\thypotenuse = calcPythagoreanTheorem(width, height),\r\n\t\t\t\t\tscale = this.scale * (hypotenuse / this.hypotenuseLength);\r\n\t\t\t\tif (this.isDisableScale) {\r\n\r\n\t\t\t\t\tscale = 1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tscale = scale <= this.minRatio ? this.minRatio : scale;\r\n\t\t\t\t\tscale = scale >= this.maxRatio ? this.maxRatio : scale;\r\n\t\t\t\t\tthis.$emit('change', {\r\n\t\t\t\t\t\twidth: this.imageWidth * scale,\r\n\t\t\t\t\t\theight: this.imageHeight * scale\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.imgMarginDetectionScale(scale);\r\n\t\t\t\tthis.hypotenuseLength = Math.sqrt(Math.pow(width, 2) + Math.pow(height, 2));\r\n\t\t\t\tthis.scale = scale;\r\n\t\t\t}\r\n\t\t},\r\n\t\timageTouchEnd() {\r\n\t\t\tthis.setDiffData({\r\n\t\t\t\tflagEndTouch: true\r\n\t\t\t})\r\n\t\t\tthis.moveStop();\r\n\t\t},\r\n\t\tuploadImage() {\r\n\t\t\tconst itemList = Object.entries(this.source)\r\n\t\t\tconst sizeType = ['original', 'compressed']\r\n\t\t\tconst success = ({tempFilePaths:a, tempFiles: b}) => {\r\n\t\t\t\tthis.image = a ? a[0] : b[0].path\r\n\t\t\t};\r\n\t\t\tconst _uploadImage = (type) => {\r\n\t\t\t\tif(type !== 'message') {\r\n\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\tcount: 1,\r\n\t\t\t\t\t\tsizeType,\r\n\t\t\t\t\t\tsourceType: [type],\r\n\t\t\t\t\t\tsuccess\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\t\tif(type == 'message') {\r\n\t\t\t\t\twx.chooseMessageFile({\r\n\t\t\t\t\t  count: 1,\r\n\t\t\t\t\t  type: 'image',\r\n\t\t\t\t\t  success\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t// #endif\r\n\t\t\t}\r\n\t\t\tif(itemList.length > 1) {\r\n\t\t\t\tuni.showActionSheet({\r\n\t\t\t\t\titemList: itemList.map(v => v[1]),\r\n\t\t\t\t\tsuccess: ({tapIndex: i}) => {\r\n\t\t\t\t\t\t_uploadImage(itemList[i][0])\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\t_uploadImage(itemList[0][0])\r\n\t\t\t}\r\n\t\t},\r\n\t\timageReset() {\r\n\t\t\tconst sys = this.sysinfo || uni.getSystemInfoSync();\r\n\t\t\tthis.scale = 1;\r\n\t\t\tthis.angle = 0;\r\n\t\t\tthis.imageTop = sys.windowHeight / 2;\r\n\t\t\tthis.imageLeft = sys.windowWidth / 2;\r\n\t\t},\r\n\t\timageLoad(e) {\r\n\t\t\tthis.imageReset();\r\n\t\t\tuni.hideLoading();\r\n\t\t\tthis.$emit('ready', e.detail);\r\n\t\t},\r\n\t\trotate(event) {\r\n\t\t\tif (this.isDisableRotate) return;\r\n\t\t\tif (!this.image) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请选择图片',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 3000\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tconst { rotateAngle } = this;\r\n\t\t\tconst originAngle = this.angle\r\n\t\t\tconst type = event.currentTarget.dataset.type;\r\n\t\t\tif (type === 'along') {\r\n\t\t\t\tthis.angle = originAngle + rotateAngle\r\n\t\t\t} else {\r\n\t\t\t\tthis.angle = originAngle - rotateAngle\r\n\t\t\t}\r\n\t\t\tthis.$emit('rotate', this.angle);\r\n\t\t},\r\n\t\tconfirm() {\r\n\t\t\tif (!this.image) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请选择图片',\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\tduration: 3000\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tuni.showLoading({\r\n\t\t\t\ttitle: '加载中'\r\n\t\t\t});\r\n\t\t\tconst { canvasHeight, canvasWidth, clipHeight, clipWidth, ctx, scale, imageLeft, imageTop, clipX, clipY, angle, scaleRatio: dpr, image, quality, fileType, type: imageType, canvasId } = this;\r\n\t\t\tconst draw = () => {\r\n\t\t\t\tconst imageWidth = this.imageWidth * scale * dpr;\r\n\t\t\t\tconst imageHeight = this.imageHeight * scale * dpr;\r\n\t\t\t\tconst xpos = imageLeft - clipX;\r\n\t\t\t\tconst ypos = imageTop - clipY;\r\n\t\t\t\tctx.translate(xpos * dpr, ypos * dpr);\r\n\t\t\t\tctx.rotate((angle * Math.PI) / 180);\r\n\t\t\t\tctx.drawImage(image, -imageWidth / 2, -imageHeight / 2, imageWidth, imageHeight);\r\n\t\t\t\tctx.draw(false, () => {\r\n\t\t\t\t\tconst width = clipWidth * dpr\r\n\t\t\t\t\tconst height = clipHeight * dpr\r\n\t\t\t\t\tlet params = {\r\n\t\t\t\t\t\tx: 0,\r\n\t\t\t\t\t\ty: 0,\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight,\r\n\t\t\t\t\t\tdestWidth: width,\r\n\t\t\t\t\t\tdestHeight: height,\r\n\t\t\t\t\t\tcanvasId: canvasId,\r\n\t\t\t\t\t\tfileType,\r\n\t\t\t\t\t\tquality,\r\n\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\tdata.url = res.tempFilePath;\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\tthis.$emit('success', data);\r\n\t\t\t\t\t\t\tthis.$emit('input', false)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: (error) => {\r\n\t\t\t\t\t\t\tconsole.error('error', error)\r\n\t\t\t\t\t\t\tthis.$emit('fail', error);\r\n\t\t\t\t\t\t\tthis.$emit('input', false)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tlet data = {\r\n\t\t\t\t\t\turl: '',\r\n\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\theight\r\n\t\t\t\t\t};\r\n\t\t\t\t\tuni.canvasToTempFilePath(params, this)\r\n\t\t\t\t});\r\n\t\t\t};\r\n\r\n\t\t\tif (canvasWidth !== clipWidth || canvasHeight !== clipHeight) {\r\n\t\t\t\tthis.canvasWidth = clipWidth;\r\n\t\t\t\tthis.canvasHeight = clipHeight;\r\n\t\t\t\tctx.draw();\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tdraw();\r\n\t\t\t\t\t}, 100);\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tdraw();\r\n\t\t\t}\r\n\t\t},\r\n\t\tcancel() {\r\n\t\t\tthis.$emit('cancel', false)\r\n\t\t\tthis.$emit('input', false)\r\n\t\t},\r\n\t}\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n@import './index'\r\n</style>","import mod from \"-!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./limeClipper.vue?vue&type=style&index=0&id=d7d092c6&scoped=true&lang=css&\"; export default mod; export * from \"-!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\app\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./limeClipper.vue?vue&type=style&index=0&id=d7d092c6&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1680404783855\n      var cssReload = require(\"D:/app/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}